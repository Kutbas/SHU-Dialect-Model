<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>小沪</title>
    <link rel="stylesheet" href="{{ url_for('static',filename='css/index.css') }}" />
    <link rel="icon" href="{{ url_for('static',filename='images/favicon.ico') }}" type="image/x-icon">
    <script src="{{ url_for('static',filename='js/vue.js') }}"></script>
    <script src="{{ url_for('static',filename='js/element-ui.js') }}"></script>
    <link rel="stylesheet" href="{{ url_for('static',filename='css/element/theme-chalk.css') }}" />
    <script src="{{ url_for('static',filename='js/index.js') }}" defer></script>
    <script src="{{ url_for('static',filename='js/script.js') }}" defer></script>
  </head>
  <body >
    <div id="app">
      <div class="main_bg" :class="{ 'collapsed-bg': !isSidebarVisible }">
        <div class="sidebar-toggle" @click="toggleSidebar">
          <img v-if="isSidebarVisible" src="{{ url_for('static',filename='images/arrow-left.png') }}" alt="收起侧边栏">
          <img v-else src="{{ url_for('static',filename='images/arrow-right.png') }}" alt="展开侧边栏">
        </div>

        <div class="clear-history-toggle" @click="toggleContentVisibility">
          <img v-if="isContentVisible" src="{{ url_for('static',filename='images/eye-open.png') }}" alt="隐藏内容">
          <img v-else src="{{ url_for('static',filename='images/eye-close.png') }}" alt="显示内容">
        </div>

        <div class="asr-toggle" @click="changeASRModel">
          <img v-if="now_asr_mode === 'huyu'" src="{{ url_for('static',filename='images/huyu-icon.png') }}" alt="沪语模型">
          <img v-else src="{{ url_for('static',filename='images/xunfei-icon.png') }}" alt="讯飞模型">
        </div>

        <div class="bg-toggle" @click="changeBackground">
          <img src="{{ url_for('static',filename='images/bg-icon.png') }}" alt="切换背景">
        </div>
        
        <div class="history-clear-toggle" @click="clearHistory">
          <img src="{{ url_for('static',filename='images/clear-history.png') }}" alt="清除历史">
        </div>

        <div class="voice-toggle" @click="changeVoiceMode">
          <img v-if="currentVoiceMode === 0" src="{{ url_for('static',filename='images/female-icon.png') }}" alt="女声模式">
          <img v-else-if="currentVoiceMode === 1" src="{{ url_for('static',filename='images/male-icon.png') }}" alt="男声模式">
          <img v-else src="{{ url_for('static',filename='images/speech-icon.png') }}" alt="朗诵模式">
        </div>

        <div class="main_left" :class="{ 'collapsed': !isSidebarVisible }">  
          <div class="menu-header">
            <img src="{{ url_for('static',filename='images/title.png') }}" alt="系统标题">
          </div>
          <div class="main_left_menu">
            <ul>
              <li><a style="color: rgba(255, 255, 255, 0.9) !important;font-weight: 600;" @click.prevent="switchPage('index')">消息</a></li>
              <li><a href="/setting" :class="{ 'active': isSettingPage }" @click.prevent="switchPage('setting')">设置</a></li>
            </ul>
          </div>
        </div>

        <div class="main_right">
          <div class="top_info" :class="{ 'transparent-bg': !isContentVisible }">
            <span class="top_info_text">状态：</span>[[panelMsg]]
          </div>
          <div class="chatmessage" :class="{ 'hidden-content': !isContentVisible }">
            <div class="chat-container" id="user0" >
              <div  v-for="(item, index) in messages" :key="index" >

                <div class="message receiver-message" v-if="item.type == 'fay'">
                  <img class="avatar" src="{{ url_for('static',filename='images/Fay_send.png') }}" alt="接收者头像">
                  <div class="message-content">
                    <div class="message-bubble">[[item.content]]</div>
                    <div class="message-time"><span class="what-time">[[item.timetext]]</span>
                    </div>
                  </div>
                </div>     

              <div class="message sender-message" v-else>
                <div class="message-content">
                  <div class="sender-message message-bubble">[[item.content]]</div>
                  <div class="sender-message-time">[[item.timetext]]</div>
                </div>
                <img class="avatar" src="{{ url_for('static',filename='images/User_send.png') }}" alt="发送者头像">
              </div>
            </div>
            <div >
                   
            </div>
            
            </div>
          </div>

          <div class="inputmessage">
            <div  class="inputmessage_voice" >

              <img v-if="!source_record_enabled" src="{{ url_for('static',filename='images/recording.png') }}" alt="" @click=changeRecord() >
              <img v-else src="{{ url_for('static',filename='images/record.png') }}" alt="" @click=changeRecord() >
            </div>
            <div class="inputmessage_input"> <textarea class="text_in" placeholder="请输入内容" v-model="newMessage" @keyup.enter="sendMessage" style="padding-top: 13px;"></textarea></div>
            <div class="inputmessage_send"><img  src="{{ url_for('static',filename='images/send.png') }}" alt="发送信息" @click="sendMessage"></div>

            <div v-if="liveState == 1" class="inputmessage_open">

              <img v-if="!play_sound_enabled" src="{{ url_for('static',filename='images/sound_off.png') }}"  @click=changeSound() >
              <img v-else src="{{ url_for('static',filename='images/sound_on.png') }}"  @click=changeSound() >
            
            </div>
            <div v-else class="inputmessage_open">
              <img  src="{{ url_for('static',filename='images/open.png') }}"  @click=startLive() >
            </div>
          </div>

        </div>
      </div>
    </div>
    </body>